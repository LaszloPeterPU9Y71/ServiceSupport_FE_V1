<!-- Gépkiválasztás -->
<div class="mb-3">

  <label class="form-label">Gép</label>
  <select class="form-select"
          [ngModel]="formData().toolId"
          (ngModelChange)="updateField('toolId', $event)">
    <option [ngValue]="null">Válassz gépet...</option>
    @for (tool of tools(); track tool.id) {
      <option [ngValue]="tool.id">{{ tool.name }} ({{ tool.itemNumber }})</option>
    }
  </select>
</div>

<div class="mb-3">
  <h5>Hibajelenség</h5>

  <select class="form-select mb-2"
          [ngModel]="selectedDefect()"
          (ngModelChange)="selectedDefect.set($event)">
    <option [ngValue]="undefined">Válassz hibát...</option>
    @for (defect of defects(); track defect.id) {
      <option [ngValue]="defect.id">{{ defect.name }}</option>
    }
  </select>

  <button class="btn btn-sm btn-outline-primary" (click)="addDefect()">Hozzáadás</button>

  <ul class="mt-2">
    @for (d of formData().defectIds; track d) {
      <li>
        {{ getDefectName(d) }}
        <button class="btn btn-sm btn-link text-danger" (click)="removeDefect(d)">Törlés</button>
      </li>
    } @empty {
      <li class="text-muted">Nincs kiválasztva hiba</li>
    }
  </ul>
</div>

<div class="mb-3">
  <h5>Megjegyzések</h5>
  <input class="form-control mb-2"
         [ngModel]="newNote()"
         (ngModelChange)="newNote.set($event)"
         placeholder="Új megjegyzés..."/>


  <button class="btn btn-sm btn-outline-primary" (click)="addNote()">Hozzáadás</button>

  <ul class="mt-2">
    @for (note of formData().notes; track note.noteId) {
      <li>
        <strong>{{ note.userName }}</strong> – {{ note.noteText }} – {{ note.postedDate | date: 'yyyy.MM.dd HH:mm' }}

        @if (authState.canDeleteComment(note.userId)) {
          <button class="btn btn-sm btn-link text-danger"
                  (click)="removeNote(note.noteId)">
            Törlés
          </button>
        }
      </li>
    } @empty {
      <li class="text-muted">Nincsenek megjegyzések</li>
    }
  </ul>

</div>


<!-- Checkboxok -->
<div class="form-check">
  <input class="form-check-input" type="checkbox"
         [checked]="formData().warranty"
         (change)="updateField('warranty', $event.target.checked)">
  <label class="form-check-label">Garanciális</label>
</div>

<div class="form-check">
  <input class="form-check-input" type="checkbox"
         [checked]="formData().hasWarrantyCard"
         (change)="updateField('hasWarrantyCard', $event.target.checked)">
  <label class="form-check-label">Jótállási kártya</label>
</div>

<div class="form-check">
  <input class="form-check-input" type="checkbox"
         [checked]="formData().hasInvoiceCopy"
         (change)="updateField('hasInvoiceCopy', $event.target.checked)">
  <label class="form-check-label">Számlamásolat</label>
</div>

<div class="form-check">
  <input class="form-check-input" type="checkbox"
         [checked]="formData().hasRegistrationProof"
         (change)="updateField('hasRegistrationProof', $event.target.checked)">
  <label class="form-check-label">Regisztrációs igazolás</label>
</div>

<!-- Assigned user -->
<div class="mb-3 mt-3">
  <label class="form-label">Szerelő</label>
  <select class="form-select"
          [ngModel]="formData().assignee"
          (ngModelChange)="updateField('assignee', $event)">
    <option [ngValue]="null">Nincs hozzárendelve</option>
    @for (user of users(); track user.id) {
      <option [ngValue]="user.id">{{ user.fullName }}</option>
    }
  </select>
</div>

<!-- Mentés -->
<button class="btn btn-primary mt-3" (click)="createWorksheet()">Mentés</button>
